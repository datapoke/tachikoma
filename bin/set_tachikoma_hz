#!perl
# ----------------------------------------------------------------------
# set_tachikoma_hz
# ----------------------------------------------------------------------
#
# $Id$
#
use strict;
use warnings;
use Tachikoma;
use Tachikoma::Config qw( %Tachikoma );
my $config = '/usr/local/etc/tachikoma.conf';
require $config if ( -f $config );

my $hz      = $ARGV[0];
my $home    = $Tachikoma{Home} || ( getpwuid $< )[7];
my $hz_file = "$home/.tachikoma/hz";
die 'invalid hz setting' if ( $hz !~ m{^\d+$} );
open my $fh, '>', $hz_file or die "couldn't open $hz_file: $!";
print {$fh} <<"EOF";
#!/usr/bin/perl
# ----------------------------------------------------------------------
# \$Id\$
# ----------------------------------------------------------------------

use strict;
use warnings;
use Tachikoma::Config qw( \%Tachikoma );

# Set our Hz
\$Tachikoma{Hz} = $hz;

1;
EOF
close $fh or die "couldn't close $hz_file: $!";

my $pid = Tachikoma->get_pid('tachikoma-server');
kill 'HUP', $pid or die "couldn't HUP $pid: $!" if ($pid);

1;
